<html>
<head>
    <title>lrn2webgl</title>
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        canvas#glcanvas {
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>
<canvas id="glcanvas" width="640" height="480"></canvas>

<script id="blinnPhong-fs" type="x-shader/x-fragment">
precision mediump float;

varying vec4 vColor;
varying vec3 normalInterp;
varying vec3 vertPos;

uniform int mode;

const vec3 lightPos = vec3(1.0,1.0,1.0);
vec3 ambientColor = vec3(vColor[0] * 0.3, vColor[1] * 0.3, vColor[2] * 0.3);
vec3 diffuseColor = vec3(vColor[0] * 0.7, vColor[1] * 0.7, vColor[2] * 0.7);
const vec3 specColor = vec3(1.0, 1.0, 1.0);

void main() {

  vec3 normal = normalize(normalInterp);
  vec3 lightDir = normalize(lightPos - vertPos);

  float lambertian = max(dot(lightDir,normal), 0.0);
  float specular = 0.0;

  if(lambertian > 0.0) {

    vec3 viewDir = normalize(-vertPos);

    // this is blinn phong
    vec3 halfDir = normalize(lightDir + viewDir);
    float specAngle = max(dot(halfDir, normal), 0.0);
    specular = pow(specAngle, 16.0);
  }

  gl_FragColor = vec4(ambientColor +
                      lambertian * diffuseColor +
                      specular * specColor, 1.0);
}

</script>

<script id="blinnPhong-vs" type="x-shader/x-vertex">
attribute vec3 aVertexPosition;
attribute vec3 aVertexNormal;
attribute vec4 aVertexColor;

uniform mat4 uPMatrix, uMVMatrix, uNormalMatrix;

varying lowp vec4 vColor;
varying vec3 normalInterp;
varying vec3 vertPos;

void main(){
    gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);

    vColor = aVertexColor;

    vec4 vertPos4 = uMVMatrix * vec4(aVertexPosition, 1.0);
    vertPos = vec3(vertPos4) / vertPos4.w;

    normalInterp = vec3(uNormalMatrix * vec4(aVertexNormal, 0.0));
}


</script>

<script src="js/friendly.js"></script>
<script src="js/palette.js"></script>

<script src="js/sylvester.js"></script>
<script src="js/glUtils.js"></script>
<script src="js/maths.js"></script>
<script src="js/model.js"></script>
<script src="js/entity.js"></script>
<script src="js/render.js"></script>
<script src="js/loader.js"></script>

<script src="js/main.js"></script>
</body>

</html>
