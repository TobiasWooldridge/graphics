<html>
<head>
    <title>lrn2webgl</title>
    <style>
        body { margin: 0; padding: 0; }
        canvas#glcanvas { width: 100%; height: 100%; }
    </style>
</head>

<script id="shader-fs" type="x-shader/x-fragment">
  varying lowp vec4 vColor;
  varying highp vec3 vLighting;

  uniform sampler2D uSampler;

  void main(void) {
    gl_FragColor = vec4(vColor.rgb * vLighting, vColor.a);
  }
</script>

<script id="shader-fs2" type="x-shader/x-fragment">
precision mediump float;

varying vec4 vColor;
varying vec3 normalInterp;
varying vec3 vertPos;

uniform int mode;

const vec3 lightPos = vec3(1.0,1.0,1.0);
vec3 ambientColor = vec3(vColor[0] * 0.3, vColor[1] * 0.3, vColor[2] * 0.3);
vec3 diffuseColor = vec3(vColor[0] * 0.7, vColor[1] * 0.7, vColor[2] * 0.7);
const vec3 specColor = vec3(1.0, 1.0, 1.0);

void main() {

  vec3 normal = normalize(normalInterp);
  vec3 lightDir = normalize(lightPos - vertPos);

  float lambertian = max(dot(lightDir,normal), 0.0);
  float specular = 0.0;

  if(lambertian > 0.0) {

    vec3 viewDir = normalize(-vertPos);

    // this is blinn phong
    vec3 halfDir = normalize(lightDir + viewDir);
    float specAngle = max(dot(halfDir, normal), 0.0);
    specular = pow(specAngle, 16.0);

    // this is phong (for comparison)
    if(mode == 2) {
      vec3 reflectDir = reflect(-lightDir, normal);
      specAngle = max(dot(reflectDir, viewDir), 0.0);
      // note that the exponent is different here
      specular = pow(specAngle, 4.0);
    }
  }

  gl_FragColor = vec4(ambientColor +
                      lambertian * diffuseColor +
                      specular * specColor, 1.0);
}
</script>

<script id="shader-vs" type="x-shader/x-vertex">
  attribute highp vec3 aVertexNormal;
  attribute highp vec3 aVertexPosition;
  attribute vec4 aVertexColor;

  uniform highp mat4 uMVMatrix;
  uniform highp mat4 uPMatrix;
  uniform highp mat4 uNormalMatrix;

  varying lowp vec4 vColor;
  varying highp vec3 vLighting;

  void main(void) {
    gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
    vColor = aVertexColor;

    // Apply lighting effect
    highp vec3 ambientLight = vec3(0.4, 0.4, 0.4);
    highp vec3 directionalLightColor = vec3(1, 1, 1);
    highp vec3 directionalVector = vec3(0.9, 0.7, 0.5);

    highp vec4 transformedNormal = uNormalMatrix * vec4(aVertexNormal, 1.0);

    highp float directional = max(dot(transformedNormal.xyz, directionalVector), 0.0);
    vLighting = ambientLight + (directionalLightColor * directional);
  }
</script>
<script id="shader-vs2" type="x-shader/x-vertex">
attribute vec3 aVertexPosition;
attribute vec3 aVertexNormal;
attribute vec4 aVertexColor;

uniform mat4 uPMatrix, uMVMatrix, uNormalMatrix;

varying lowp vec4 vColor;
varying vec3 normalInterp;
varying vec3 vertPos;

void main(){
    gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);

    vColor = aVertexColor;

    vec4 vertPos4 = uMVMatrix * vec4(aVertexPosition, 1.0);
    vertPos = vec3(vertPos4) / vertPos4.w;

    normalInterp = vec3(uNormalMatrix * vec4(aVertexNormal, 0.0));
}

</script>

<body onload="onLoad()">
    <canvas id="glcanvas" width="640" height="480"></canvas>

    <script src="sylvester.js" type="text/javascript"></script>
    <script src="glUtils.js" type="text/javascript"></script>
    <script src="maths.js" type="text/javascript"></script>
    <script src="entity.js" type="text/javascript"></script>
    <script src="script.js" type="text/javascript"></script>
    <script src="loader.js" type="text/javascript"></script>
</body>

</html>